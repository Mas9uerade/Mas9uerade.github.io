---
layout:     post
title:      "3D数学基础"
subtitle:   " \"向量，矩阵，坐标系\""
date:       2020-12-2 18:15:46
author:     "Mas9uerade"
header-img: ""
tags:
    - 3D数学
---

> 面试被问了向量，矩阵，旋转矩阵，四元数的问题，需要好好总结一下

# 3D数学基础

## 向量

#### 1. 向量的加减

向量的加减就是每个值的加减

#### 2. 向量的Magnitude

向量的每个分量平方后相加再开根号

#### 3. 向量的点积

点积， 又称内积（Inner Product）， dot满足交换率

几何意义：

1. 一个向量在另一个向量上的投影；
2. 点积求Magnitude
3. 点积可以求夹角（ cos）

#### 4. 向量的叉积

叉积（cross product），又称外积（outer product），叉积的结果是一个向量

$  a x b =  (ax, ay, az) x (bx, by, bz) = (aybz - azby, azbx - axbz, axby, aybx)  $

1. 叉积不满足交换律，满足反交换律

2. **叉积的模 等于 a 和b的模再乘于他们间夹角的正弦值**

$ |a x b| = |a| |b| sin(theta) $

3. 叉积可以计算平行四边形的面积

## 矩阵

#### 1. 矩阵的乘法

矩阵A （r x n）与矩阵B（n x c）相乘，形成的矩阵是（r x c）大小的
$$
c_{ij}  = sum (a_{i1}b_{1j} + a_{i2}b_{2j} +…… + a_{in}b_{nj} = \sum_{k=1}^na_{ik}b_{kj}
$$
![matrix_mul.png-25kB](http://static.zybuluo.com/candycat/u6urub3wacveq0qcr6112we5/matrix_mul.png)

**1. 矩阵的乘法不满足交换律 **

**2. 矩阵乘法满足结合律 **

#### 2. 特殊矩阵

**1.方块矩阵**

对角矩阵

**2.单位矩阵**

和任何矩阵相乘都是原来的矩阵

**3.转置矩阵**

转置矩阵是原矩阵的反转 （Transposed Matrix）

**矩阵的转置的转置等于原矩阵**

**4. 逆矩阵**

逆矩阵与原矩阵相乘会是一个单位矩阵
$$
 MM^{-1} = I
$$
**性质一：**

**逆矩阵的逆矩阵是原矩阵的本身。**
$$
(M^{-1})^{-1} = M
$$
**性质二：**

**单位矩阵的逆矩阵是它本身**
$$
I^{-1}=I
$$
**性质三：**

**转置矩阵的逆矩阵是逆矩阵的转置**
$$
(M^(T))^{-1} = (M^{-1})^T
$$
**性质四：**

**矩阵串接相乘后的逆矩阵等于反响串接个个矩阵的逆矩阵**
$$
(AB)^{-1} = B^{-1}A^{-1}
$$

$$
(ABCD)^{-1} = D^{-1}C^{-1}B^{-1}A^{-1}
$$

**逆矩阵的几何意义**

**矩阵可以表示一个变换，那么逆矩阵允许我们还原这个变换，或者说是这个变换的反向变换。**

如果我们用变换矩阵M对向量v做了一次变换，然后使用它的逆矩阵 $M^{-1}$ 进行另一次的变换，我们就会得到原来的向量
$$
M^{-1} (Mv) =(M^{-1}M)v = Iv = v
$$
**5.正交矩阵**

正交是矩阵的一个属性，如果一个方阵和它的转置矩阵的乘积是单位矩阵的话，那么这个矩阵即为正交矩阵
$$
MM^T = M^TM =I
$$
矩阵的正交即意味着
$$
M^T = M^{-1}
$$
正交矩阵的特点：

* **矩阵的每一行，即 $c_1, c_2, c_3 $ 都是单位矢量，只有这样他们和自己的点积为1**

* **矩阵的每一行，$ c_1，c_2, c_3 $ 之间互相垂直，只有这样他们之间的点积才能为0**

* **上述两条结论对矩阵的每一列同样适用，如果M是正交矩阵， M^T也会是正交矩阵**

## 矩阵变换

#### 线性变换 （linear transform）

线性变换指可以保留向量加和标量乘的变换。
$$
f(x) + f(y) = f(x+y)
$$

$$
kf(x) = f(kx)
$$

线性变换包括

缩放，

旋转，

错切，错切是在某方向上，按照一定的比例对图形的每个点到某条平行于该方向的直线的有向距离做放缩得到的平面图形。

[![img](https://bkimg.cdn.bcebos.com/pic/b2de9c82d158ccbf2d76e19e1ed8bc3eb035414f?x-bce-process=image/resize,m_lfit,w_268,limit_1/format,f_jpg)](https://baike.baidu.com/pic/错切/7024094/0/b2de9c82d158ccbf2d76e19e1ed8bc3eb035414f?fr=lemma&ct=single)

### 平面的水平和竖直错切

在平面

![img](https://bkimg.cdn.bcebos.com/formula/c716dad2b8a538ee37a52bf13237f5d0.svg)

上，水平错切（或平行于X轴的错切）是一个将任一点

![img](https://bkimg.cdn.bcebos.com/formula/67f1e6683e06c849e1a087e8a664e5e1.svg)

[映射](https://baike.baidu.com/item/映射)到点

![img](https://bkimg.cdn.bcebos.com/formula/2a288b34e15bf298388bb8a3b513d567.svg)

的操作，

![img](https://bkimg.cdn.bcebos.com/formula/4f88ebed045531c75bb193bac407450c.svg)

是固定参数，称为错切因子。

水平错切的效果是将每一点水平移动，移动的长度和该点的纵坐标成比例。若

![img](https://bkimg.cdn.bcebos.com/formula/ba4e7c6e1db27f15aa4f8fff2eb341b3.svg)

则

![img](https://bkimg.cdn.bcebos.com/formula/4675185d7b4028ecceae6b1456352cd4.svg)

轴上方的所有点都向右移动，

![img](https://bkimg.cdn.bcebos.com/formula/b4be63cb4559c4975001c95f86ddac31.svg)

则

![img](https://bkimg.cdn.bcebos.com/formula/4675185d7b4028ecceae6b1456352cd4.svg)

轴上方的所有点都向左移动，

![img](https://bkimg.cdn.bcebos.com/formula/4675185d7b4028ecceae6b1456352cd4.svg)

轴下方点移动的方向对应相反，而

![img](https://bkimg.cdn.bcebos.com/formula/4675185d7b4028ecceae6b1456352cd4.svg)

坐标轴上的点位置不变。平行于

![img](https://bkimg.cdn.bcebos.com/formula/4675185d7b4028ecceae6b1456352cd4.svg)

轴的直线保持不变，其他所有线绕与

![img](https://bkimg.cdn.bcebos.com/formula/4675185d7b4028ecceae6b1456352cd4.svg)

轴交点转动不同的角度；原来竖直的线则变成斜率

![img](https://bkimg.cdn.bcebos.com/formula/20388a86a391ec1fd4b2973874f4d18a.svg)

的斜线，如此参数

![img](https://bkimg.cdn.bcebos.com/formula/5a3ae2778fc98a56b8e7baf1f93922a5.svg)

，

![img](https://bkimg.cdn.bcebos.com/formula/630f537c083a797214747764b534ea1c.svg)

即竖直线倾斜后的倾角，称为错切角。

如果把点的坐标写成一个列向量，则错切可以表示成一个

![img](https://bkimg.cdn.bcebos.com/formula/4365ef894c9e8fb61f6da6b455320196.svg)

的矩阵和坐标的乘积：

[![img](https://bkimg.cdn.bcebos.com/pic/7a899e510fb30f242c9caba7cf95d143ad4b030b?x-bce-process=image/resize,m_lfit,w_250,h_250,limit_1)](https://baike.baidu.com/pic/错切/7024094/0/7a899e510fb30f242c9caba7cf95d143ad4b030b?fr=lemma&ct=single)

竖直错切的操作类似，就是将x和y互换位置。转制矩阵如下：

（未知原因，图片无法插入）

经过竖直错切后，原来竖直的直线不变，其他线绕其与y轴交点旋转，原来水平的线变成斜率m的线。

### 广义错切

对于向量空间V和其子空间W，一个对于W的错切将变换所有和W平行的向量。

具体来讲，如果V是W和W'的直和，我们把V写成：

![img](https://bkimg.cdn.bcebos.com/formula/0414f9d96e604d7a3c698156c271ec41.svg)

那么一个对于W的错切L即：

![img](https://bkimg.cdn.bcebos.com/formula/95ddc49d0129489b61b5009af95f97a8.svg)

其中M是从W'到W的一个线性映射。用分块矩阵表示，则L写成：

$$
\begin{bmatrix}
I&M\\
M&I\\
\end{bmatrix}
$$

镜像，

正交投影。

平移变换是非线性的，

#### 仿射变换 （affine transform）

仿射变换是合并线性变换和平移变换的变换类型，可以用一个4x4的矩阵表示，因此我们需要把矢量扩展到四维空间下，即**齐次坐标空间（homogeneous space)**

| 变换名称               | 是否线性变换 | 是否仿射变换 | 是可逆矩阵 | 是正交矩阵 |
| ---------------------- | ------------ | ------------ | ---------- | ---------- |
| 平移矩阵               | N            | Y            | Y          | N          |
| 绕坐标轴旋转的旋转矩阵 | Y            | Y            | Y          | Y          |
| 绕任意轴的旋转矩阵     | Y            | Y            | Y          | Y          |
| 按坐标轴的缩放矩阵     | Y            | Y            | Y          | N          |
| 错切矩阵               | Y            | Y            | Y          | N          |
| 镜像矩阵               | Y            | Y            | Y          | Y          |
| 正交投影矩阵           | Y            | Y            | N          | N          |
| 透视投影矩阵           | N            | N            | N          | N          |

**齐次坐标空间**

齐次坐标是3x3的矩阵拓展到4x4的矩阵，对于一个点从三维坐标转换为齐次坐标需要把其w分量设置为1，对于方向矢量需要把其w分量设置为0。这样设置会导致，当用一个4x4的矩阵对一个点进行变换时，平移/旋转/缩放都会施用于该点，但若是用于一个方向矢量，平移效果就会被忽略。

#### 平移矩阵

平移矩阵可作用于点，但无法作用于方向向量
$$
\begin{bmatrix}
x&0&0&t_x\\
0&y&0&t_y\\
0&0&z&t_z\\
0&0&0&1
\end{bmatrix}
$$


平移矩阵的逆矩阵就是反向平移得到的矩阵，即
$$
\begin{bmatrix}
x&0&0&-t_x\\
0&y&0&-t_y\\
0&0&z&-t_z\\
0&0&0&1
\end{bmatrix}
$$
因此平移矩阵不是一个正交矩阵
#### 缩放矩阵

缩放矩阵可作用于点，且能作用于方向向量
$$
\begin{bmatrix}
k_x&0&0&0\\
0&k_y&0&0\\
0&0&k_z&0\\
0&0&0&1
\end{bmatrix}
$$

$$
如果 k_x,k_y,k_z 相等，则缩放为统一缩放， 否则为非统一缩放
$$

缩放矩阵的逆矩阵，为反向缩放得到的矩阵，即

$$
\begin{bmatrix}
1/k_x&0&0&0\\
0&1/k_y&0&0\\
0&0&1/k_z&0\\
0&0&0&1
\end{bmatrix}
$$

上述矩阵仅适用于沿坐标轴方向进行缩放。如果想要在任意方向上进行缩放，就需要使用一个复合变换，其中一种方法的主要思想就是，先将缩放周转换为标准坐标轴，然后进行坐标轴缩放，再用逆变换得到原来的缩放轴朝向。

#### 旋转矩阵

**绕X轴旋转**
$$
R_x(\theta) = \begin{bmatrix}
1&0&0&0\\
0&cos(\theta)& -sin(\theta)&0\\
0&sin(\theta)& cos(\theta)&0\\
0&0&0&1
\end{bmatrix}
$$
**绕Y轴旋转**
$$
R_y(\theta) = \begin{bmatrix}
cos(\theta)&0& sin(\theta)&0\\
0&1&0&0\\
-sin(\theta)&0& cos(\theta)&0\\
0&0&0&1
\end{bmatrix}
$$
**绕Z轴旋转**
$$
R_z(\theta) = \begin{bmatrix}
cos(\theta)&-sin(\theta)&0&0\\
sin(\theta)&cos(\theta)&0&0\\
0&0&1&0\\
0&0&0&1
\end{bmatrix}
$$

旋转矩阵的逆矩阵是旋转相反的角度得到的变换矩阵，旋转矩阵为正交矩阵，多个旋转矩阵的串联同样是正交。

#### 复合变换

**先缩放，再旋转，最后平移**

Unity旋转矩阵的旋转顺序是zxy。
$$
当给定一个旋转角度（\theta_x,\theta_y,\theta_z)时，得到的组合旋转矩是\\
M_{rotate_Z} M_{rotate_X} M_{rotate_Y} =
\begin{bmatrix}
cos(\theta_z)&-sin(\theta)&0&0\\
sin(\theta)&cos(\theta)&0&0\\
0&0&1&0\\
0&0&0&1\\
\end{bmatrix}
\begin{bmatrix}
cos(\theta)&0& sin(\theta)&0\\
0&1&0&0\\
-sin(\theta)&0& cos(\theta)&0\\
0&0&0&1\\
\end{bmatrix}
\begin{bmatrix}
1&0&0&0\\
0&cos(\theta)& -sin(\theta)&0\\
0&sin(\theta)& cos(\theta)&0\\
0&0&0&1\\
\end{bmatrix}
$$
当给定



#### 坐标空间变换

定义一个坐标空间需要指明其原点位置以及3个坐标轴的方向，这是相对于其他空间的，因此每个空间都为其他空间的子空间，每个空间都会拥有父空间。

坐标空间的变换即为在父空间和子空间之间对点和矢量进行变换。

因此，
$$
A_P = M_{C->P}A_C
$$

$$
A_c = M_{P->C}A_C
$$

$$
且M_{C->P} 与 M_{P->C}互为逆矩阵
$$

